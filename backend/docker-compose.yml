version: "3.9"

x-backend-common: &backend-common
  restart: unless-stopped
  env_file:
    - ../.env
  networks:
    - backend

services:
  fetcher:
    <<: *backend-common
    build:
      context: .
      dockerfile: services/fetcher/Dockerfile
    ports:
      - "8101:8000"

  parser:
    <<: *backend-common
    build:
      context: .
      dockerfile: services/parser/Dockerfile
    ports:
      - "8102:8000"
    depends_on:
      - fetcher

  deduper:
    <<: *backend-common
    build:
      context: .
      dockerfile: services/deduper/Dockerfile
    ports:
      - "8103:8000"

  embeddings:
    <<: *backend-common
    build:
      context: .
      dockerfile: services/embeddings/Dockerfile
    ports:
      - "8104:8000"

  clusterer:
    <<: *backend-common
    build:
      context: .
      dockerfile: services/clusterer/Dockerfile
    ports:
      - "8105:8000"

  summarizer:
    <<: *backend-common
    build:
      context: .
      dockerfile: services/summarizer/Dockerfile
    ports:
      - "8106:8000"

  verifier:
    <<: *backend-common
    build:
      context: .
      dockerfile: services/verifier/Dockerfile
    ports:
      - "8107:8000"

  ranker:
    <<: *backend-common
    build:
      context: .
      dockerfile: services/ranker/Dockerfile
    ports:
      - "8108:8000"

  api_gateway:
    <<: *backend-common
    build:
      context: .
      dockerfile: services/api_gateway/Dockerfile
    ports:
      - "8110:8000"
    depends_on:
      - ranker
      - verifier

  admin_console:
    <<: *backend-common
    build:
      context: .
      dockerfile: services/admin_console/Dockerfile
    ports:
      - "3000:3000"
    depends_on:
      - api_gateway

networks:
  backend:
    driver: bridge
